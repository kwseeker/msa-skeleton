# Gateway 原理篇

源码版本 2.2.5.RELEASE。

首先整理清思路：Gateway终究也只是个Web应用，虽然基于WebFlux, 但是应该和MVC一样有请求Handler Mapping，而根据应用篇对Gateway的了解。这里研究Gateway源码就需要先找到这个Handler Mapping 的代码，然后要看路由route组件（包括内部的断言、过滤器）怎么加载执行的，最后可能还需要看下其他限流组件、服务发现组件是怎么起作用的。

即：

+ Gateway Handler Mapping
+ Gateway 路由组件加载 & 执行
+ Gateway 其他组件加载 & 执行



## WebFlux Handler Mapping

在 spring-boot-demo 中创建了个测试Demo。通过此Demo研究 WebFlux 请求处理流程。



## Gateway 路由组件

还是从 spring-cloud-starter-gateway 开始分析。

其 pom.xml 引入了三个主要的依赖

```xml
spring-cloud-gateway-core
spring-boot-starter-webflux
spring-cloud-starter-loadbalancer
```

**先看spring-cloud-gateway-core：**

spring.factories定义

```properties
# Auto Configure
org.springframework.boot.autoconfigure.EnableAutoConfiguration=\
org.springframework.cloud.gateway.config.GatewayClassPathWarningAutoConfiguration,\
org.springframework.cloud.gateway.config.GatewayAutoConfiguration,\
org.springframework.cloud.gateway.config.GatewayHystrixCircuitBreakerAutoConfiguration,\
org.springframework.cloud.gateway.config.GatewayResilience4JCircuitBreakerAutoConfiguration,\
org.springframework.cloud.gateway.config.GatewayLoadBalancerClientAutoConfiguration,\
org.springframework.cloud.gateway.config.GatewayNoLoadBalancerClientAutoConfiguration,\
org.springframework.cloud.gateway.config.GatewayMetricsAutoConfiguration,\
org.springframework.cloud.gateway.config.GatewayRedisAutoConfiguration,\
org.springframework.cloud.gateway.discovery.GatewayDiscoveryClientAutoConfiguration,\
org.springframework.cloud.gateway.config.SimpleUrlHandlerMappingGlobalCorsAutoConfiguration,\
org.springframework.cloud.gateway.config.GatewayReactiveLoadBalancerClientAutoConfiguration

org.springframework.boot.env.EnvironmentPostProcessor=\
org.springframework.cloud.gateway.config.GatewayEnvironmentPostProcessor
```

GatewayAutoConfiguration 中定义核心功能：



## Gateway 其他组件

